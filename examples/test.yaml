master:
  repo:
    - https://github.com/adam-mcdaniel/dragon
  title:
    - Dragon CI
  title-url:
    - "https://github.com/adam-mcdaniel/dragon"
  webserver-ip:
    - localhost
  poll-interval:
    - 5

workers:
  dragon-vm-worker:
    basedir:
      - "/home/adam/Desktop/ASGarD/cons-buildbot/examples/vm-worker"
    masterhost:
      - localhost
    password:
      - pass

  IT_WORKED:
    basedir:
      - "/home/adam/Desktop/ASGarD/cons-buildbot/examples/test-worker"
    masterhost:
      - localhost
    password:
      - pass

  dragon-compiler-worker:
    basedir:
      - "/home/adam/Desktop/ASGarD/cons-buildbot/examples/compiler-worker"
    masterhost:
      - localhost
    password:
      - pass

schedulers:
  vm-change:
    branch:
      - ".*"
    triggers:
      - '.*\.cpp'
      - '.*\.hpp'
    builders:
      - dragon-vm-build

  compiler-change:
    branch:
      - master
    triggers:
      - '.*\.py'
    builders:
      - dragon-compiler-build
      - dragon-testing

builders:
  dragon-vm-build:
    repo:
      url:
        - "https://github.com/adam-mcdaniel/dragon"
      branch:
        - master

    workers:
      - dragon-vm-worker

    script:
      - rm -Rf build
      - mkdir build
      - cd build
      - cmake ..
      - make

  dragon-compiler-build:
    repo:
      url:
        - https://github.com/adam-mcdaniel/dragon
      branch:
        - master

    workers:
      - dragon-compiler-worker

    script:
      - python3 -m pip install -U lark-parser
      - python3 compiler/main.py -f examples/script.dn

  dragon-testing:
    repo:
      url:
        - https://github.com/adam-mcdaniel/dragon
      branch:
        - master

    workers:
      - IT_WORKED

    script:
      - python3 -m pip install -U lark-parser
      - python3 compiler/main.py -f examples/script.dn
